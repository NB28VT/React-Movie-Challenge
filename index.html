<html>
<head>
  <meta charset="utf-8">
  <title>Movie Game</title>
  <!-- Script tags including React -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react-dom.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <link rel="stylesheet" type="text/css" href="index.css">
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" /> -->
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
</head>
<body>
  <div class="title">
    <h1>MovieMatcher5000</h1>
  </div>
  <div id="app"></div>
  <!--Future: break into separate files and run on webserver -->
  <!-- https://stackoverflow.com/questions/30200028/react-component-in-seperate-script-does-not-work -->
  <!-- <script src="Components.js" type="text/babel"></script> -->
  <script src="config.js" type="text/javascript"></script>
  <script type="text/babel">

    class App extends React.Component {
      render() {
        return (
          // TODO: Movie selector with poster API!
          // http://img.omdbapi.com/?apikey=[yourkey]&
          <GameBoard url={"http://www.omdbapi.com/?apikey=" + config.SECRET_KEY + "&t=Star%20Wars/"}/>
        )
      }
    }

    class GameBoard extends React.Component {
      // Constructor to get actors
      constructor(props){
        super(props);
        this.state = {
          movieData: [],
          actors: [],
          answerKey: []
        }
      }

      componentDidMount(){
        this.getMovie();
        // const actorList = this.state.actors.split(",")
        // actorList.map(this.getActor(actorName))
      }

      getActor(actorName) {
        $.ajax({
          url: "http://www.omdbapi.com/?apikey=${config.SECRET_KEY}&type=actor&s=${actorName}/",
          type: "get",
          dataType: "JSONP",
          success: function(data) {
            this.setState((state) => ({actors: this.state.actors.concat(data) }));
          }.bind(this),
          error: function(xhr, status, error){
            console.log(error);
          }.bind(this)
        })
      }

      getMovie(){
        $.ajax({
          url: this.props.url,
          type: "get",
          dataType: "JSONP",
          success: function(data) {
            this.setState({movieData: data});
            const _this = this;
            // TODO: ES6 this:
            data["Actors"].split(",").map(function(actorName){
              _this.getActor(actorName.replace(" ", "%20"))
            })
            debugger;
          }.bind(this),
          error: function(xhr, status, error){
            console.log(error);
          }.bind(this)
        })
      }

      render(){
        const actors = this.state.actors;
        // const scrambledNames = scrambleNames();
        //
        // scrambleNames(){
        //   //
        // }
        return(
          <div className="actorRow">
            // Map with scrambled name
            {actors.map((actor) => (
              <Actor image={actor.image} actualName={actor.name}/>
            ))}
          </div>
        )
      }
    }

    var mount = document.querySelector('#app');
    ReactDOM.render(<App />, mount);
  </script>






</body>
</html>
