<html>
<head>
  <meta charset="utf-8">
  <title>Movie Game</title>
  <!-- Script tags including React -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react-dom.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <link rel="stylesheet" type="text/css" href="index.css">
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" /> -->
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>
  <nav class="navbar navbar-inverse">
    <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">MovieMatcher5000</a>
    </div>
  </nav>


  <div class="container-fluid">
    <div class="row">
      <div class="col-md-1"></div>
      <div class="col-md-10 app" id="app"></div>
      <div class="col-md-1"></div>
    </div>
  </div>
  <!--Future: break into separate files and run on webserver -->
  <!-- https://stackoverflow.com/questions/30200028/react-component-in-seperate-script-does-not-work -->
  <!-- <script src="Components.js" type="text/babel"></script> -->
  <script src="config.js" type="text/javascript"></script>
  <script type="text/babel">

    class App extends React.Component {
      render() {
        return (
          // TODO: SEARCH FEATURE

          <GameBoard movieUrl={"https://api.themoviedb.org/3/movie/1891?api_key=" + config.TMDB_V3_KEY}
            actorUrl={"https://api.themoviedb.org/3/movie/1891/credits?api_key=" + config.TMDB_V3_KEY}
          />

        )
      }
    }

    class GameBoard extends React.Component {
      constructor(props){
        super(props);
        this.state = {
          movieData: [],
          cast: [],
          scrambledCast: []
        }
      }

      componentDidMount(){
        this.getMovie();
        this.getCast();
      }

      getCast(actorName) {
        $.ajax({
          url: this.props.actorUrl,
          type: "get",
          dataType: "JSONP",
          success: function(data) {
            const firstFive = data.cast.slice(0,5);
            // Select 5 cast members
            this.setState({
              cast: firstFive,
              scrambledCast: this.shuffleCast(firstFive)
            });
          }.bind(this),
          error: function(xhr, status, error){
            console.log(error);
          }.bind(this)
        })
      }

      getMovie(){
        $.ajax({
          url: this.props.movieUrl,
          type: "get",
          dataType: "JSONP",
          success: function(data) {
            this.setState({movieData: data});
          }.bind(this),
          error: function(xhr, status, error){
            console.log(error);
          }.bind(this)
        })
      }

      shuffleCast(castMembers){
          // Fisher-Yates shuffle for fun
          var remainingCount = castMembers.length, top, index;
          while(remainingCount) {
            // Pick a random remaining element
            index = Math.floor(Math.random() * remainingCount--);
            // Swap it with the current element
            top = castMembers[remainingCount];
            castMembers[remainingCount] = castMembers[index];
            castMembers[index] = top;
          }
          return castMembers;
      }

      render(){
        const cast = this.state.cast;

        return(
            <div className="gameBoard">
              <div className="castRow">
                {cast.map((castMember) => (
                  <div className="castMember">
                    <CastMember thumbnailUrl={castMember.profile_path} actualName={castMember.name} personId={castMember.id}/>
                  </div>
                ))}
              </div>
            </div>
        )
      }
    }

    class CastMember extends React.Component {
      render(){
        const thumbnailUrl = "https://image.tmdb.org/t/p/w500" +  this.props.thumbnailUrl + "?api_key=" + config.TMDB_V3_KEY;

        return(
          // TODO: return array of divs with new React?
          // Pass actualName to nameSelector props?
          <div>
            <img className="castThumbnail" src={thumbnailUrl}/>
            <nameSelector/>
          </div>
        )
      }
    }

    class nameSelector extends React.Component {
      render() {
        const scrambledCast = this.state.scrambledCast;
        console.log(scrambledCast);
        // TODO: React Boostrap buttons?
        // https://react-bootstrap.github.io/introduction.html
        return(
          <select>
            <option>Select Name</option>
            {scrambledCast.map((castMember) => (
              <option>{castMember.name}</option>
            ))}
          </select>
        )
      }
    }

    var mount = document.querySelector('#app');
    ReactDOM.render(<App />, mount);
  </script>






</body>
</html>
